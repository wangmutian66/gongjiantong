<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>
            商品添加
        </title>
        <meta content="" name="keywords"/>
        <meta content="" name="description"/>
        <link href="favicon.ico" rel="shortcut icon"/>
        <link href="SELLER_CSS/bootstrap.min.css?v=3.3.6" rel="stylesheet"/>
        <link href="SELLER_CSS/font-awesome.css?v=4.4.0" rel="stylesheet"/>
        <link href="SELLER_CSS/plugins/iCheck/custom.css" rel="stylesheet"/>
        <link href="SELLER_CSS/animate.css" rel="stylesheet"/>
        <link href="SELLER_CSS/style.css?v=4.1.0" rel="stylesheet"/>
        <link href="SELLER_CSS/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet"/>
        <link href="SELLER_CSS/plugins/sweetalert/sweetalert.css" rel="stylesheet">
        <link href="SELLER_CSS/photoclip/jquery.gridly.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="SELLER_CSS/plugins/webuploader/webuploader.css">
        <link rel="stylesheet" type="text/css" href="SELLER_CSS/demo/webuploader-demo.css">
        <link href="SELLER_CSS/preview/style.css" rel="stylesheet">
        <script type="text/javascript" charset="utf-8" src="__UEDITOR__/ueditor.config.js"></script>
        <script type="text/javascript" charset="utf-8" src="__UEDITOR__/ueditor.all.js"> </script>
        <script type="text/javascript" charset="utf-8" src="__UEDITOR__/lang/zh-cn/zh-cn.js"></script>
        <!-- Web Uploader -->
        <script type="text/javascript">
            var BASE_URL = 'SELLER_JS/plugins/webuploader';
            var url = '{:url("seller/Goods/goodsImg")}';
            var gp = 'gp_picture_path[]';
            var addImg = 'goods_img';
        </script>

        <script src="SELLER_JS/photoclip/jquery-1.11.2.min.js"></script>
        <!--<script src="SELLER_JS/photoclip/vendor/jquery.ui.widget.js"></script>
        <script src="SELLER_JS/photoclip/jquery.iframe-transport.js"></script>-->
        <script type="text/javascript" src="SELLER_JS/photoclip/tools.js"></script>
        <script src="SELLER_JS/photoclip/ajaxfileupload.js"></script>
        <script src="SELLER_JS/photoclip/jquery.gridly.js" type="text/javascript"></script>
        <script src="SELLER_JS/photoclip/iscroll-zoom.js"></script>
        <script src="SELLER_JS/photoclip/hammer.js"></script>
        <script src="SELLER_JS/photoclip/lrz.all.bundle.js"></script>
        <script src="SELLER_JS/photoclip/jquery.photoClip.js"></script>

        <!--<script type="text/javascript" src="SELLER_JS/photoclip/pictureHandle.js"></script>-->

        <style>
            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                  -webkit-appearance: none;
            }
            .gui{
                border: solid 1px gray;
                min-width: 70px;
                float: left;
                margin: 0px 4px;
                text-align: center;
                padding: 6px 12px;
                border-radius: 5px;
                cursor: pointer;
            }
            #temp-img-list > div{
                margin-top: 10px;
                position: relative;
            }
            #temp-img-list span{
                display: inline-block;
                padding: 5px 10px;
                position: absolute;
                top:10px;
                left: 10px;
                border:1px solid #ccc;
                border-radius: 3px;
                background: rgba(255,255,255,0.8);
                cursor: pointer;
            }
            #namne,.jiage1,.weight1{ width:70px;}
        </style>
        <script type="application/javascript">
            function ajaxFileUploads(){
                if($("#g_show_img_path").val()==""){

                    return false;
                }
                $.ajaxFileUpload
                (
                    {

                        url: '{:url("seller/Goods/goodsImgupdate")}', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        data: { img:$("#g_show_img_path").val() },
                        fileElementId: ['g_show_img_path'], //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data, status)  //服务器成功响应处理函数
                        {
                            $("#g_show_img_path1").val(data["pic_cover"]);
                            $("#views").html("<img src='/public/upload/"+data["pic_cover"]+"' width='200'>");

                        },
                        error: function (data, status, e)//服务器响应失败处理函数
                        {
                            alert(data);
                        }
                    }
                )
                return false;
            }

            function _filechange(filename){

                if($("#"+filename).val()==""){
                    return false;
                }
                $.ajaxFileUpload
                (
                    {
                        url: '{:url("seller/Goods/goodsImgupdate")}', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        data: { img:$("#"+filename).val() },
                        fileElementId: [filename], //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data, status)  //服务器成功响应处理函数
                        {

                            $("#"+filename).siblings("img").attr("src","/public/upload/"+data["pic_cover"]);
                            $("#"+filename).siblings(".filenames").val(data["pic_cover"]);
                            // $("#g_show_img_path1").val(data["pic_cover"]);
                            // $("#views").html("<img src='/public/upload/"+data["pic_cover"]+"' width='200'>");

                        },
                        error: function (data, status, e)//服务器响应失败处理函数
                        {
                            alert(data);
                        }
                    }
                )
                return false;


            }


        </script>
    </head>


    <body class="gray-bg">
    <a  data-toggle="modal" data-target="#myModal3" class="yulan" style="display: none;">预览</a>
    <div class="modal " id="myModal3" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated flipInY">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">商品详情</h4>
                </div>
                <div class="modal-body">
                    <div id="iframe-wrap" class="mobile-width-2">
                    <!--手机预览html开始-->
                    <div class="demo " id="outer">
                        <div class="ztl-line"></div>

                        <div class="headline">
                            <img src="SELLER_IMG/preview/fanhui_07.jpg" />
                            <ul>
                                <li class="action">商品</li>
                                <li>详情/规格</li>
                                <li>评价</li>
                            </ul>
                            <img src="SELLER_IMG/preview/fanhui_04.jpg" />
                        </div>
                        <div class="scrollwindow">
                            <div class="swiper-container">
                                <div class="swiper-wrapper" id="inner">
                                    <div class="indeximg iimg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                    </div>

                                    <div class="titleline">
                                    <span>
                                        <div class="scimg"><img src="SELLER_IMG/preview/shoucang_04.jpg"></div>
                                        <div class="sctitle">收藏</div>
                                    </span>
                                        <div class="tline">
                                            <img src="SELLER_IMG/preview/chang_07.jpg">
                                            <div class="title">禹王专业防水禹王专业防水禹王专业防水禹王专业防水禹王专业防水</div>
                                        </div>
                                    </div>

                                    <div class="jiagebox">
                                        <span>销量 <span class="g_sales">0</span></span>
                                        <div class="jg"><strong>￥</strong><em class="xdbefore">0.</em><b class="xdafter">00</b></div>
                                    </div>

                                    <div class="maijiabaozheng more">
                                        <b><img src="SELLER_IMG/preview/deng.png"></b>
                                        {foreach name="guarantes" item = "g"}
                                        <span>{$g.guname}</span>
                                        {/foreach}
                                    </div>

                                    <div class="a-demo">
                                        <div class="a-title">商品活动</div>

                                        <div class="a-content acttitle">暂无活动</div>
                                    </div>



                                    <div class="a-demo border-top more">
                                        <b><img src="SELLER_IMG/preview/deng.png"></b>
                                        <div class="a-title">选择规格</div>
                                        <div class="a-content actguige">已选规格已选规格</div>
                                    </div>
                                    <div class="a-demo border-top demo-img">
                                        <img src="SELLER_IMG/preview/spxiangqing.jpg">
                                    </div>

                                    <div class="indeximg ylimgs">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                    </div>

                                    <div class="a-demo border-top demo-img">
                                        <img src="SELLER_IMG/preview/spxiangqing.jpg">
                                    </div>

                                    <div class="indeximg g_content">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                        <img src="SELLER_IMG/preview/zst_03.jpg">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dibu dibuimg">
                            <img src="SELLER_IMG/preview/dibu_02.jpg">
                        </div>

                    </div>
                    <!--手机预览html结束-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a data-toggle="modal" data-target="#myModal23" id="mysqlqietu">
        <i class="fa fa-plus"></i>
        商品添加
    </a>
       <div class="modal fade" id="myModal23" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"   aria-hidden="true">

            <div class="modal-dialog">
                <div class="modal-content ">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">图片截取</h4>
                    </div>
                    <div style="padding: 0px 30px 30px 30px;">
                        <div id="clipArea"></div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-primary" id="clipBtn"  data-dismiss="modal"> 确定</button>
                        <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>

    </div>

        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div>
                    <div class="tabs-container">
                        <ul class="nav nav-tabs">
                            <li class="active"><a data-toggle="tab" aria-expanded="true" onclick="tab('1')">商品信息</a>
                            </li>
                            <li class=""><a data-toggle="tab" aria-expanded="false" onclick="tab('2')">商品详情</a>
                            </li>
                            <!--<li class=""><a data-toggle="tab" aria-expanded="false" onclick="tab('3')">商品轮播图</a>-->
                            <!--</li>-->
                            <!-- <li class=""><a data-toggle="tab" aria-expanded="false" onclick="tab('4')">商品属性</a>
                            </li> -->
                        </ul>
                        <div class="tab-content">
                            <form class="form-horizontal" method="POST" action="{:url('seller/Goods/goodsAdd1')}" enctype="multipart/form-data" id="goodsAdd1" onsubmit="return goodsEdit();">
                                <div id="tab-1" class="tab-pane active">
                                    <div class="panel-body">
                                        <div class="col-sm-12">
                                            <div class="ibox float-e-margins">
                                                <div class="ibox-content">
                                                    <input type="hidden" name="sgc1_id" value="{$sgc1_id}">
                                                    <input type="hidden" name="sgc_id" value="{$sgc_id}">
                                                    <input type="hidden" name="mgc_id" value="{$mgc_id}">
                                                    <input type="hidden" name="mgb_id" value="{$mgb_id}">

                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            商品系列
                                                        </label>
                                                        <div class="col-sm-2 m-b-xs">
                                                            <select class="input-sm form-control input-s-sm inline" name="sgt_id" style="height: 32px;" id="sgt_id" required="" aria-required="true" aria-invalid="true">
                                                                <option value="">请选择商品系列</option>
                                                                {if condition="isset($sgt_value) and !empty($sgt_value)"}
                                                                    {foreach name="sgt_value" item = "sgt"}
                                                                        <option value="{$sgt.sgt_id}">{$sgt.sgt_name}</option>
                                                                    {/foreach}
                                                                {/if}
                                                            </select>
                                                        </div>

                                                    </div>
                                                    <div class="hr-line-dashed"></div>
                                                <div id="guiges" style="display:none">
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            商品规格
                                                        </label>
                                                        <div class="col-sm-2 m-b-xs" style="width:80%">
                                                            <a name="firstAnchor"></a>
                                                            <a name="firstAnchors"></a>
                                                              <div id="ajax_spec_data">
                                                                  
                                                              </div>
                                                        </div>
                                                    </div>
                                                    <div class="hr-line-dashed"></div>
                                                </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            商品名称
                                                        </label>
                                                        <div class="col-sm-5">
                                                            <input class="form-control" type="text" required="" aria-required="true" aria-invalid="true" name="g_name" maxlength="30"/>
                                                        </div>
                                                    </div>

                                                   


                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            上传商品图片
                                                        </label>
                                                        <div class="col-sm-5">
                                                            <input type="hidden"  name="g_show_img_path1" id= "g_show_img_path1" value="">
                                                            <input  type="file" aria-required="true" aria-invalid="true" name="g_show_img_path" id="g_show_img_path" onchange="ajaxFileUploads()" />
                                                            <div id="views"  style=" margin-top: 35px;">

                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                           商品轮播图片
                                                        </label>
                                                        <div class="col-sm-5" style="position: relative; min-height:157px;">
                                                            <input type="file" id="file23" name="file23" style="display: none;" multiple/>
                                                            <div id="view" class="gridly">

                                                            </div>

                                                            <div class="viewboxadd">
                                                                <img src="SELLER_IMG/addimg.png" />
                                                            </div>
                                                        </div>
                                                    </div>


                                
                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            是否上架
                                                        </label>
                                                        <div class="col-sm-10">
                                                            <div class="radio radio-info radio-inline">
                                                                <input type="radio" name="s_is_show" id="s_is_show1" checked value="0" />
                                                                <label for="s_is_show1"> 上架 </label>
                                                            </div>
                                                            <div class="radio radio-info radio-inline" >
                                                                <input type="radio" name="s_is_show" id="s_is_show2"  value="1" />
                                                                <label for="s_is_show2" > 下架 </label>
                                                            </div>
                                                        </div>
                                                    </div>


                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            重量
                                                        </label>
                                                        <div class="col-sm-5" style="position: relative;">
                                                            <input class="form-control" type="text" required="" aria-required="true" aria-invalid="true" name="g_weight"/> <span style="position: absolute;top: 5px;right: -10px;">kg</span>
                                                            <!--<span id="msg" style="color:red; display: none;">该单位需要汉字</span>-->
                                                        </div>
                                                    </div>
                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            商品包装单位
                                                        </label>
                                                        <div class="col-sm-5">
                                                            <input class="form-control" type="text" required="" aria-required="true" aria-invalid="true" name="g_unit_name" onblur="_g_unit_name()" />
                                                            <span id="msg" style="color:red; display: none;">该单位需要汉字</span>
                                                        </div>
                                                    </div>

                                                    <div class="hr-line-dashed"></div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            商品关键字
                                                        </label>
                                                        <div class="col-sm-5 inputmarinbottom">
                                                            <input class="form-control" type="text"  name="g_keywords[]" />
                                                            <br/>
                                                            <input class="form-control" type="text"  name="g_keywords[]" />
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="filesarray">

                                </div>
                                <div id="tab-2" class="tab-pane" style="display:none">
                                    <div class="panel-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">
                                                商品详细描述
                                            </label>
                                            <div class="col-sm-8"  >
                                                <script id="editor" type="text/plain" style="height:500px;" name="g_content"></script>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div id="tab-3" class="tab-pane">
                                    <div >
                                        <div class="ibox float-e-margins" style="border: unset;">
                                            <div class="ibox-content" style="border-style: unset;">
                                                <div class="page-container">
                                                    <p style="margin-left: 2%;color: red;font-weight: bold;">请上传格式为：JPG JPEG PNG GIF 的图片</p>
                                                    <div id="uploader" class="wu-example">
                                                        <div class="queueList">
                                                            <div id="dndArea" class="placeholder">
                                                                <div id="filePicker"></div>
                                                                <p>或将照片拖到这里，最多可选5张</p>
                                                            </div>
                                                        </div>
                                                        <div class="statusBar" style="display:none;">
                                                            <div class="progress">
                                                                <span class="text">0%</span>
                                                                <span class="percentage"></span>
                                                            </div>
                                                            <div class="info"></div>
                                                            <div class="btns">
                                                                <div id="filePicker2"></div>
                                                                <div class="uploadBtn">开始上传</div>
                                                            </div>
                                                        </div>
                                                        <div id="goods_img">
                                                             
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2 pull-right">
                                        <input class="btn btn-primary" type="submit"  value="提交审核" />
                                        <input class="btn btn-primary" type="button"  value="预览" onclick="preview()"/>
                                        <input class="btn btn-white" type="button" onclick="window.history.go(-1)" value="取消" />
                                    </div>
                                </div>   
                            </form>
                        </div>
                    </div>
                </div>
            </div> 
        </div>
                                                    <div id="temp-img-list" style="display:none;"></div>
        <!-- 全局js -->
        <!--<script src="SELLER_JS/jquery.min.js?v=2.1.4"></script>-->
        <script src="SELLER_JS/bootstrap.min.js?v=3.3.6"></script>

        <script src="SELLER_JS/plugins/webuploader/webuploader.min.js"></script>

        <script src="SELLER_JS/demo/webuploader-demo.js"></script>
        <!-- 自定义js -->
        <script src="SELLER_JS/content.js?v=1.0.0"></script>
        <script src="SELLER_JS/globals.js?v=1.0.0"></script>
        <!-- iCheck -->
        <script src="SELLER_JS/plugins/iCheck/icheck.min.js"></script>
        <!-- 复文本编辑器js -->
        <script src="SELLER_JS/plugins/sweetalert/sweetalert.min.js"></script>

        <script>
            window.onload = function(){
                $("#tab-3").css("display","none");
            }

            function _g_unit_name(){
                var g_unit_name = $("input[name=g_unit_name]").val();
                var myReg = /^[\u4e00-\u9fa5]+$/;
                if (myReg.test(g_unit_name)) {
                    $("#msg").hide();
                } else {
                    $("#msg").show();
                    return false;
                }
            }
            function goodsEdit(){
                var g_name = $("input[name=g_name]").val();
                var g_unit_name = $("input[name=g_unit_name]").val();
                var viewlength = $("#view .imgdemo").length;
                $(document.body).attr("yulan","1");
                if(viewlength<=0){
                    swal({
                        title: "通讯提示!",
                        text: "请上传商品轮播图片"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }

                if(g_name == ""){
                    swal({
                        title: "通讯提示!",
                        text: "商品名称不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }

                if(g_unit_name == ""){
                    swal({
                        title: "通讯提示!",
                        text: "商品包装单位不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }
                if($("#namne").length == 0) {
                    window.location.hash = "#firstAnchor";

                    swal({
                        title: "通讯提示!",
                        text: "商品规格不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }
                if ($("#namne").val() == ""){
                    window.location.hash = "#firstAnchors";

                    swal({
                        title: "通讯提示!",
                        text: "商品规格属性不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }
                var g_show_img_path= $("input[name=g_show_img_path]").val();
                if(g_show_img_path==""){
                    swal({
                        title: "通讯提示!",
                        text: "商品主图片不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }

                var g_weight = $("input[name=g_weight]").val();
                if(g_weight==""){
                    swal({
                        title: "通讯提示!",
                        text: "商品重量不能为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }
                var g_unit_name = $("input[name=g_unit_name]").val();
                if(g_unit_name == ""){
                    swal({
                        title: "通讯提示!",
                        text: "商品包装单位为空"
                    });
                    $(document.body).attr("yulan","0");
                    return false;
                }

                var editorCon = UE.getEditor('editor').getContent();

                if(editorCon=="<p><br/></p>" || editorCon == ""){

                    swal({
                        title: "通讯提示!",
                        text: "商品详情不能为空"
                    });
                    $(".nav-tabs li").eq(1).addClass("active").siblings().removeClass("active");
                    tab('2');
                    $(document.body).attr("yulan","0");
                    return false;
                }


            }


            function getCategory(id,add) {
                if (id > 0) {
                    $.ajax({
                        url:"{:url('seller/Goods/getGoodCategory')}",
                        type:"post",
                        data:{id:id},
                        dataType:"json",
                        success:function(info){
                            $("#gl_parent_id_"+add).empty();
                            if (info.code == 200) {
                                var opt = "<option value=''>请选择商品分类</option>";
                                var data = JSON.parse(info.data);
                                $.each(data,function(i,n){
                                    opt += "<option value='" + n.mgc_id + "'>" + n.mgc_name + "</option>";
                                })
                                $("#gl_parent_id_"+add).append(opt);
                            }else{
                                var opt = "<option value=''>请选择商品分类</option>";
                                $("#gl_parent_id_"+add).append(opt);
                            }
                        },
                        error:function(){
                            swal({
                                title: "通讯出错!",
                                text: "请联系开发人员或管理员!"
                            });
                        }
                    })
                }
            }
            function tab(id) {
                for(var i=1;i<=4;i++){
                    $("#tab-"+i).removeClass('active');
                    $("#tab-"+i).css('display','none');
                }
                $("#tab-"+id).addClass('active');
                $("#tab-"+id).css('display','');
                if(id == 2){
                    $("#temp-img-list").show();
                }else{
                    $("#temp-img-list").hide();
                }
            }
           /** 以下 商品规格相关 js*/
            $(document).ready(function(){
                // 商品类型切换时 ajax 调用  返回不同的属性输入框
                $("#sgt_id").change(function(){
                    $("#ajax_spec_data").html('');
                    $("#guiges").css('display','');
                    var sgt_id = $(this).val();
                    $.ajax({
                        type:'POST',
                        data:{sgt_id:sgt_id},
                        url:'{:url("seller/Goods/ajaxBrandspname")}',
                        success:function(data){

                            var gdata = data.data;
                            if (gdata!='') {
                            var guis = eval('('+gdata+')');
                            };
                            var gui = data.code;
                            if (gui!='-1') {
                                for (var i=0;i<gui.length;i++){
                                    $("#ajax_spec_data").append('<div class="gui" id="guis'+guis[i]["id"]+'" onclick="kucun('+guis[i]["id"]+' , &quot;'+guis[i]["sp_name"]+'&quot;)">'+guis[i]["sp_name"]+'</div> ');
                                }
                            }else{
                                $("#ajax_spec_data").html('');
                                $("#guiges").css('display','none');
                            }
                        },
                        error:function () {
                           $("#ajax_spec_data").html('');
                           $("#guiges").css('display','none');
                        }
                    });
                });
            });
            function kucun(id , name){
                $("#guis"+id).addClass("guisid").css({'background-color':'#23b7e5','color':'#fff','border-color':'#23b7e5'});
                if (id==$("#s"+id).attr("value")) {
                     $("#guis"+id).removeClass("guisid").css({'background-color':'#fff','color':'gray','border-color':'gray'});
                    $("#y"+id).remove();
                }else{
                    $("#ajax_spec_data").append('<div style="clear:both"></div><div style="margin-top:5px" id="y'+id+'"><span style="margin-right:20px"> '+name+' </span><input type="hidden"  name="sp_id[]" value="'+id+'" id="s'+id+'">库存：<input type="text" name="kucuns[]"  id="namne"/> (件)&nbsp;&nbsp;&nbsp;&nbsp; 价格：<input type="text" name="jiages[]"  class="jiage1" onblur="_number(this)"/> (元) &nbsp;&nbsp;&nbsp;&nbsp; 重量：<input type="text" name="weight1[]"  class="weight1" onblur="_number(this)"/> (kg)  <span><input type="file" name="file'+id+'" id="file'+id+'" onchange="_filechange(\'file'+id+'\')" style="display: none;"><img style="width: 30px; cursor: pointer;" src="SELLER_IMG/add-button.jpg" onclick="declick(this)"><input type="hidden" name="filenames[]" class="filenames"></span></div> ');

                }
            }


            function declick(element){
                $(element).siblings("input[type=file]").click();
            }

            function _number(element){
                if($(element).val().split(".").length>2){
                    swal({
                        title: "出错啦!",
                        text: "当前价格不能出现两个小数点，请重新输入",
                    });
                    $(element).val("");
                }
            }

            /**
             * 作者：袁中旭
             * 时间：2017-11-18
             * 功能：AJAX获取商品品牌
             */
            function search() {
                var brand_search = $("#brand_searchs").val();
                $.ajax({
                    url:'{:url("seller/Goods/ajaxBrandSearch")}',
                    type:"post",
                    data:{brand_search:brand_search},
                    dataType:"json",
                    success:function (info) {
                        if (info.code == 200) {
                            $("select[name='mgb_id']").empty();
                            var opt = "<option value=''>请选择商品品牌</option>";
                            var data = JSON.parse(info.data);
                            $.each(data, function(i, n) {
                                opt += "<option value='" + n.mgb_id + "'>" + n.mgb_name + "</option>";
                            })
                            $("select[name='mgb_id']").append(opt);
                        } else {
                            swal({
                                title: "出错啦!",
                                text: info.msg,
                            });
                        }
                    },
                    error:function () {
                        swal({
                            title: "通讯出错!",
                            text: "请联系开发人员或管理员!"
                        });
                    }
                })
            }
        </script>
        <script>
            var ue = UE.getEditor('editor', {
                toolbars: [
                    ['fullscreen','insertimage']
                ],
                autoHeightEnabled: true,
                autoFloatEnabled: true,
            });
            //ue.blur();
            // UE.getEditor('editor').blur();

            // console.log(ue.getContent());
            //
            // UE.getEditor('blog_content');

            //事件
            ue.addListener("ready",function(){

                ue.setDisabled(['insertimage']);

            });
            ue.addListener("selectionchange",function(e){

              // var text = ue.getContent();
              //
              // if(text!= null && text != "") {
              //     var reg = /<p><img.*?\/><\/p>/g;
              //
              //     if(text.match(reg)){
              //         var etext = text.match(reg).join("");
              //         // console.log(etext);
              //         UE.getEditor('editor').setContent(etext);
              //     }else{
              //
              //         swal({
              //             title: "通讯提示!",
              //             text: "只能上传图片1！"
              //         });
              //         UE.getEditor('editor').setContent('');
              //     }
              // }

                // var reg =/[\u4e00-\u9fa5]|[A-Z]/g;
                // text.replace(reg, "");
                // UE.getEditor('editor').setContent(text.replace(reg, ""));
            });
            ue.addListener('contentChange', function (editor) {
                var img = ue.getPlainTxt();
                var imghtml = ue.getContent();
                if (img != "") {

                    var eduiwidth = $("#edui1").width();
                    var eduiheight = $("#edui1").height();
                    var eduitop = $("#edui1").offset().top;
                    var eduileft = $("#edui1").offset().left;

                    $("#temp-img-list").css({
                        "position":"absolute",
                        "left":eduileft+8,
                        "top":eduitop+35,
                        "width":eduiwidth-8,
                        "background":"#fff"
                    });
                    $("#temp-img-list").html(imghtml);

                    var nimg = "";
                    $("#temp-img-list img").each(function (key,element) {
                        nimg += "<div class='imgp'><span onclick='delimg(this)'>删除</span><div class='imgpc'><img src='"+$(element).attr("src")+"'></div></div>";
                    });
                    $("#temp-img-list").html(nimg);



                }
            });

            function delimg(element){
                $(element).parents(".imgp").remove();
                var updateimg = "";
                $("#temp-img-list .imgp").each(function(key,element){
                    updateimg +="<p>"+$(element).find(".imgpc").html()+"</p>";
                });
                ue.setContent(updateimg);
            }

            $(document).ready(function () {

                $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
                });

                $("#view").change(function(){
                    console.log("1111111111");
                    console.log($(this).children(".imgdemo").length);
                });

            });
        </script>
        <script>
            var clipArea = new bjj.PhotoClip("#clipArea", {
                size: [375, 219],
                outputSize: [375, 219],
                file: "#file23",
                view: "#view",
                ok: "#clipBtn",
                loadStart: function() {
                    //console.log("照片读取中");
                },
                loadComplete: function() {
                    //console.log("照片读取完成");
                    $("#mysqlqietu").click();
                },
                clipFinish: function(dataURL) {
                    //console.log(dataURL);
                }
            });


            $(".viewboxadd").click(function(){
                $("#file23").click();
            });

            function preview(){
                goodsEdit();
                var yulan = $(document.body).attr("yulan");
                if(yulan == "1"){
                    $(".yulan").click();
                    $(".iimg img").attr("src","http://{$_SERVER['SERVER_NAME']}"+$("#views img").attr("src"));
                    //商品名称
                    $(".tline .title").html($("input[name=g_name]").val());

                    var jgarr = $(".jiage1").val().split(".");
                    $(".xdbefore").html(jgarr[0]+".");
                    $(".xdafter").html(jgarr[1]);



                    $(".actguige").html();
                    var guigetext = $("#ajax_spec_data > div.guisid").eq(0).html();
                    $(".actguige").html(guigetext);
                    var editortext =  UE.getEditor('editor').getContent();
                    $(".g_content").html(editortext);
                    //商品展示
                    var imgdemohtml = "";
                    $(".imgdemo").each(function(key,element){
                        imgdemohtml+="<img src='"+$(element).find("img").attr("src")+"'>";
                    });
                    $(".ylimgs").html(imgdemohtml);


                }
            }
        </script>
    </body>
</html>
