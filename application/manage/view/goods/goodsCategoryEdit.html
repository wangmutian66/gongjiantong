<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>
            修改商品文类
        </title>
        <meta content="" name="keywords"/>
        <meta content="" name="description"/>
        <link href="favicon.ico" rel="shortcut icon"/>
        <link href="MANAGE_CSS/bootstrap.min.css?v=3.3.6" rel="stylesheet"/>
        <link href="MANAGE_CSS/font-awesome.css?v=4.4.0" rel="stylesheet"/>
        <link href="MANAGE_CSS/plugins/iCheck/custom.css" rel="stylesheet"/>
        <link href="MANAGE_CSS/animate.css" rel="stylesheet"/>
        <link href="MANAGE_CSS/style.css?v=4.1.0" rel="stylesheet"/>
        <link href="MANAGE_CSS/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet"/>
        <link href="MANAGE_CSS/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    </head>
    <body class="gray-bg">
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-sm-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>修改商品文类</h5>
                            <div class="ibox-tools" style="margin-right: 15px;">
                                <a class="close-link" href="{:url('manage/index/welcome')}">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                            <div class="ibox-tools" style="margin-right: 15px;">
                                <a href="{:url('manage/Goods/goodsCategoryList')}">
                                    <i class="fa fa-bars"></i>
                                    商品分类列表
                                </a>
                            </div>
                        </div>  
                        <div class="ibox-content">
                            <form class="form-horizontal" method="POST" action="{:url('manage/Goods/goodsCategoryEdit',array('id'=>$info['mgc_id']))}">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                        商品分类名称
                                    </label>
                                    <div class="col-sm-5">
                                        <input class="form-control" type="text" required="" id="mgc_name" onblur="verifyInput('mgc_name','chsAlphaNum','mgc_name_show')" aria-required="true" aria-invalid="true" name="mgc_name" value="{$info.mgc_name}"/>
                                    </div>
                                    <code id="mgc_name_show">只能填写中文,英文及数字!</code>
                                </div>
                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                        分类归属
                                    </label>
                                    <div class="col-sm-2 m-b-xs">
                                        <select class="input-sm form-control input-s-sm inline" onchange="getCategory(this.value,'second_parent_id','')" name="first_parent_id" id="first_parent_id" style="height: 32px;">
                                        </select>
                                    </div>
                                    <div class="col-sm-2 m-b-xs">
                                        <select class="input-sm form-control input-s-sm inline" name="second_parent_id" id="second_parent_id" style="height: 32px;">
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                        排序
                                    </label>
                                    <div class="col-sm-5">
                                        <input class="form-control" type="number" min="1" max="100" id="mgc_sort" onblur="verifyInput('mgc_sort','num','mgc_sort_show')" required aria-required="true" aria-invalid="true" name="mgc_sort"  value="{$info.mgc_sort}" />
                                    </div>
                                    <code id="mgc_sort_show">从1-100,值越低越靠前</code>
                                </div>
                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">
                                        描述
                                    </label>
                                    <div class="col-sm-5">
                                        <textarea  class="form-control" name="mgc_desc" id="" rows="4">{$info.mgc_desc|default=""}</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" style="padding-top: 0px;">
                                        是否开启
                                    </label>
                                    <div class="col-sm-10">
                                        <div class="switch">
                                            <div class="onoffswitch">
                                                <input type="checkbox" {if condition="$info.mgc_is_show eq '1'"} checked {/if} class="onoffswitch-checkbox" id="mgc_is_show" name="mgc_is_show">
                                                <label class="onoffswitch-label" for="mgc_is_show">
                                                    <span class="onoffswitch-inner"></span>
                                                    <span class="onoffswitch-switch"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" style="padding-top: 0px;">
                                        是否热门
                                    </label>
                                    <div class="col-sm-10">
                                        <div class="switch">
                                            <div class="onoffswitch">
                                                <input type="checkbox" {if condition="$info.is_hot eq '1'"} checked {/if} class="onoffswitch-checkbox" id="is_hot" name="is_hot">
                                                <label class="onoffswitch-label" for="is_hot">
                                                    <span class="onoffswitch-inner"></span>
                                                    <span class="onoffswitch-switch"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2 pull-right">
                                        <input class="btn btn-primary" type="submit" value="保存内容" />
                                        <input class="btn btn-white" type="button" onclick="window.history.go(-1)" value="取消" />
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 全局js -->
        <script src="MANAGE_JS/jquery.min.js?v=2.1.4"></script>
        <script src="MANAGE_JS/bootstrap.min.js?v=3.3.6"></script>
        <!-- 自定义js -->
        <script src="MANAGE_JS/content.js?v=1.0.0"></script>
        <!-- iCheck -->
        <script src="MANAGE_JS/plugins/iCheck/icheck.min.js"></script>
        <script src="MANAGE_JS/plugins/sweetalert/sweetalert.min.js"></script>
        <script type="text/javascript" src="MANAGE_JS/globals.js"></script>
        <script>
            $(document).ready(function () {
                $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
                });
            });
            function getCategory(id,html_id,parent_id) {
                if (id != '') {
                    $.ajax({
                        url:'{:url("manage/Goods/ajaxGetCategory")}',
                        type:"post",
                        data:{id:parseInt(id)},
                        dataType:"json",
                        success:function (info) {
                            if (info.code != '1') {
                                swal({
                                    title: "数据请求失败,请稍候再试!~",
                                    text: info.msg
                                });
                            }else{
                                data = JSON.parse(info.data); 
                                if (id == 0) {
                                    var opt = "<option value='0'>顶级分类</option>";
                                } else {
                                    var opt = "<option value=''>请选择分类</option>";
                                }
                                console.log(parent_id);
                                if (data.length > 0) {
                                    $.each(data,function(i,n) {
                                        if (id == 0 && parent_id == n.mgc_id) {
                                            opt += "<option value='" + n.mgc_id + "' selected>" + n.mgc_name + "</option>";
                                        } else if (parent_id == n.mgc_id && parent_id != 0) {
                                            opt += "<option value='" + n.mgc_id + "' selected>" + n.mgc_name + "</option>";
                                        } else {
                                            opt += "<option value='" + n.mgc_id + "'>" + n.mgc_name + "</option>";
                                        }
                                    })
                                }
                                $("#"+html_id).empty().append(opt);
                            }
                        },
                        error:function () {
                            swal({
                                title: "通讯出错!",
                                text: "请联系开发人员或管理员!"
                            });
                        }
                    });
                }else{
                    var opt = "<option value=''>请选择分类</option>";
                    $("#"+html_id).empty().append(opt);
                }
            }
            {if condition="isset($mgc_parent_path['1']) and isset($mgc_parent_path['2'])"}
                getCategory("0","first_parent_id","{$mgc_parent_path['1']}");
                getCategory("{$mgc_parent_path['1']}","second_parent_id","{$mgc_parent_path['2']}");
            {elseif condition="isset($mgc_parent_path['1'])"/} 
                getCategory("0","first_parent_id","{$mgc_parent_path['1']}");
                getCategory("{$mgc_parent_path['1']}","second_parent_id","");
            {else /}
                getCategory("0","first_parent_id","");
                getCategory("","second_parent_id","");
            {/if}

            limitInput('mgc_name','chsAlphaNum');
            limitInput('mgc_sort','num');
        </script>
    </body>
</html>
